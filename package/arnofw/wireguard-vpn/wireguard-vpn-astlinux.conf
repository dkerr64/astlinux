# ------------------------------------------------------------------------------
#            -= Arno's iptables firewall - WireGuard VPN plugin =-
# ------------------------------------------------------------------------------

# To actually enable this plugin make ENABLED=1:
# ------------------------------------------------------------------------------
# Automatically enabled when AstLinux WireGuard VPN is enabled.
ENABLED=0

# ------------------------------------------------------------------------------
# *** Do Not Edit Below Here ***
# AstLinux specific mappings, either edit your /mnt/kd/rc.conf file
# or, use Network tab -> WireGuard VPN - [WireGuard Configuration]
# from the web interface.
# ------------------------------------------------------------------------------
# Indent script section so script variables won't be merged

  ENABLED=0
  WIREGUARD_VPN_PORT=""
  WIREGUARD_VPN_TUNNEL_HOSTS="$WIREGUARD_TUNNEL_HOSTS"
  vpntype_wireguard=0

  unset IFS
  for vpntype in $VPN; do
    case $vpntype in
      wireguard) vpntype_wireguard=1 ;;
    esac
  done

  if [ $vpntype_wireguard -eq 1 ]; then
    wireguard_vpn_config="/mnt/kd/wireguard/${WIREGUARD_IF:-wg0}.conf"
    if [ -f "$wireguard_vpn_config" ]; then
      WIREGUARD_VPN_PORT="$(sed -n -r -e '/^\[[Ii]nterface/,/^\[/ s/^[Ll]isten[Pp]ort *= *([0-9]+).*$/\1/p' $wireguard_vpn_config)"
      ENABLED=1
    fi
  fi

